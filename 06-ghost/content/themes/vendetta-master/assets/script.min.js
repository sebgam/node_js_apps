/** javascript-asynchronous-loader version 1.0.0
 Dated:2016-02-18 */
function Loader(a,b){this.loadCount=0,this.totalRequired=a.length,this.callback=b;for(var c=a.length;c--;)document.getElementById(a[c])&&"loaded"===document.getElementById(a[c]).loaded&&(this.totalRequired--,a.splice(c,1));for(0===this.totalRequired&&b(),c=a.length;c--;)this.writeScript(a[c])}var $script=function(a,b){new Loader(a,b)};$script.path=function(a){Loader.prototype.path=a},Loader.prototype={loaded:function(a,b){this.loadCount++,b.loaded="loaded",this.loadCount==this.totalRequired&&"function"==typeof this.callback&&this.callback.call()},path:"",attach_callback:function(a){var b=this;a.readyState?a.onreadystatechange=function(){("loaded"==a.readyState||"complete"==a.readyState)&&(a.onreadystatechange=null,b.loaded("a",a))}:a.addEventListener?a.addEventListener("load",function(c){b.loaded(c,a)},!1):a.attachEvent&&a.attachEvent("load",function(c){b.loaded(c,a)})},writeScript:function(a){var b=this;if(document.getElementById(a)){var c=document.getElementById(a);return void b.attach_callback(c)}var d=document.createElement("script");d.id=a,d.type="text/javascript",d.async=!0,a.split("//").length>1?d.src=a:d.src=this.path+a,b.attach_callback(d);var e=document.getElementsByTagName("head")[0];e.appendChild(d)}};
var gView;

Loader.prototype.path=velma_url;
$script(['https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js','https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js'],function(){
		$script(['https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.2.3/backbone-min.js'],function(){


			gView = Backbone.View.extend({
				el: $('html'), // el attaches to existing element
				events: {
				},
				initialize: function(){
					_.bindAll(this, 'render'); // every function that uses 'this' as the current object should be in here
					this.render();
				},
				render: function(){
					var self=this;
					this.loadcommentcount();
					this.loadimages();
					this.newsletter();
					$script(["https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"],function(){
						$(".post-content").fitVids();
					})

				},
				newsletter:function(undefined){
					if(velma.newsletter!==undefined){
						$(".email").attr("placeholder","Email Address");
						if(velma.newsletter.hide===undefined||velma.newsletter.hide===false){
							if(velma.newsletter.popup!==undefined&&velma.newsletter.popup!==false){
							$("#mce-EMAIL").attr("placeholder","Email Address");
							var popp=$('<div id="myModal" class="modal fade text-center" role="dialog"><div class="modal-dialog"><!-- Modal content--><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title colfff"><strong>Subscribe to our Updates</strong></h4></div><div class="modal-body">'+$("#mc_embed_signup").html()+'</div></div></div></div>');
							if(sessionStorage.getItem("popped")!=="yes")
								$script(["https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"],function(){
									setTimeout(function(){
										popp.modal();
										sessionStorage.setItem("popped","yes");
									},velma.newsletter.time===undefined?20000:1000*velma.newsletter.time);
							})
							}
						}
						else $("#mc_embed_signup").remove();
					}
				},
				loadimages:function(){
					$("[data-bg]").each(function(){
						var $thi = $(this),adr=$thi.data('bg');
						$el=$("<div>").addClass("progbar").appendTo($thi);
						function asyncload($this,url,pbar){
							$.ajax({
									url : url,
									cache: true,
									processData : false,
									timeout:120000,
									xhrFields:{
									 onprogress: function(progress){
										 if(progress.lengthComputable){
												 var percentage = Math.floor((progress.loaded / progress.total) * 100);
												 pbar.animate({'width': percentage+'%'},100);
											}
									 }
								 }
							}).success(function(){
									pbar.remove();
									$this.css("background-image",'url('+url+')').addClass("blog-cover-bg");
							}).fail(function(jqxhr,t){
								if(t==='timeout')
									asyncload($this,url,pbar);
							})
						}
						asyncload($thi,adr,$el);
					})
				},
				loadcommentcount:function(undefined){
					if(velma.comment.disqus!==undefined&&typeof velma.comment.disqus === 'string'){
						disqus_shortname=velma.comment.disqus;
							var disqus_identifier = 'ghost-{{id}}';
							$script(['//' + velma.comment.disqus + '.disqus.com/count.js'],function(){});
							$(".disqus-comment-count").show();
					}
					if(velma.comment.facebook!==undefined&&velma.comment.facebook==='enabled'){
							$script(["//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.5"],function(){});
							$(".fb-comment-count").show();
					}
				}
			});
			var ListView = Backbone.View.extend({
				el: $('html'), // el attaches to existing element
				events: {
					'mouseenter .post-list-image': 'showCompleteImage',
					'click .opendialog ':'openDialog',
					'mouseenter .endorse-blog-button':'showEndorse',
					'mouseleave .endorse-blog-button':'hideEndorse'
				},
				initialize: function(){
					_.bindAll(this, 'render'); // every function that uses 'this' as the current object should be in here
					this.render();
				},
				render: function(){
					var self=this;
					this.configure_share();
					new gView();
				},
				configure_share:function(){
					$("html").find(".openpinterestdialog").each(function(index,ele){
							$(this).attr("href","http://pinterest.com/pin/create/button/?url="+encodeURIComponent($(this).attr("href"))+"&media="+encodeURIComponent($(this).data("ihref")));
					});
					$("html").find(".opentumblrdialog").each(function(index,ele){
							$(this).attr("href","http://www.tumblr.com/share/link?url="+encodeURIComponent($(this).attr("href"))+"&name="+$(this).data("title")+"&description="+$(this).data("desc"));
					});
				},
				openDialog:function(ev){
					var $this=$(ev.currentTarget);
					window.open($this.attr("href"), $this.attr("title"),'width=500,height=300');
					return false;
				}
			});
			var listView = new ListView();




		});
})
loadCss("https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css");
loadCss("https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.0.0-beta.3/assets/owl.carousel.min.css");
loadCss("https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.0.0-beta.3/assets/owl.theme.default.min.css");
